{
  "$schema": "https://ev2schema.azure.net/schemas/2020-04-01/RegionAgnosticRolloutSpecification.json",
  "contentVersion": "1.0.0",
  "rolloutMetadata": {
    "serviceModelPath": "ServiceModel.json",
    "scopeBindingsPath": "ScopeBindings.json",
    "configuration": {
      "serviceGroupScope": {
        "specPath": "config/config.$rolloutInfra().$serviceGroup().json"
      } 
    },
    "name": "Microsoft.Azure.PDG.Infrastructure.DataEstateHealth",
    "rolloutType": "major",
    "buildSource": {
      "parameters": {
        "versionFile": "version.txt"
      }
    },
    "notification": {
      "email": {
        "to": "zachmadsen@microsoft.com"
      }
    }
  },
  "orchestratedSteps": [
    {
      "name":"deployInfrastructure",
      "targetType": "ServiceResourceDefinition",
      "targetName": "infrastructureResourceGroupDefinition",
      "actions": ["deploy"]
    },
    {
      "name": "pushContainerImages",
      "targetType": "ServiceResourceDefinition",
      "targetName": "containerImagesResourceGroupDefinition",
      "actions": ["Shell/Run"],
      "dependsOn": ["deployInfrastructure"]
    },
    {
      "name":"deployApiService",
      "targetType": "ServiceResourceDefinition",
      "targetName": "apiServiceContainerAppResourceGroupDefinition",
      "actions": ["deploy"],
      "dependsOn": ["pushContainerImages"]
    }
  ]
}